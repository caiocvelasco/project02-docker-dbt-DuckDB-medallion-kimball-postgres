# Defines external sources and their locations within your data warehouse.

sources:
- name: data                     # This is the name that will be used as reference in the dbt models        
  description: "External tables using Parquet and inferring the schema"
  database: "{{ env_var('SNOWFLAKE_DATABASE') }}"
  schema: "{{ env_var('SNOWFLAKE_SCHEMA_BRONZE') }}"  # Specifies the schema where the external sources reside
  loader: S3
  tables:
  - name: customers
    ext_full_refresh: true
    description: "External table with customers information"
    external:
      location: "@my_dbt_database.bronze.my_s3_stage"  # reference an existing External Stage in Snowflake
      file_format: "(TYPE = PARQUET)"
      # infer_schema: true   # parameter to tell Snowflake we want to infer the table schema
    columns:
      - name: CustomerID
        data_type: int
      - name: Name
        data_type: varchar(100)
      - name: Age
        data_type: int
      - name: Gender
        data_type: varchar(10)
      - name: SignupDate
        data_type: date
  - name: dates
    ext_full_refresh: true
    description: "External table with dates information"
    external:
      location: "@my_dbt_database.bronze.my_s3_stage"  # reference an existing external stage
      file_format: "(TYPE = PARQUET)"
      # infer_schema: true   # parameter to tell Snowflake we want to infer the table schema
    columns:
      - name: DateID
        data_type: int
      - name: Date
        data_type: date
      - name: Week
        data_type: int
      - name: Month
        data_type: int
      - name: Quarter
        data_type: int
      - name: Year
        data_type: int
  - name: product_usage
    ext_full_refresh: true
    description: "External table with product usage information"
    external:
      location: "@my_dbt_database.bronze.my_s3_stage"  # reference an existing external stage
      file_format: "(TYPE = PARQUET)"
      # infer_schema: true   # parameter to tell Snowflake we want to infer the table schema
    columns:
      - name: UsageID
        data_type: int
      - name: CustomerID
        data_type: int
      - name: DateID
        data_type: int
      - name: ProductID
        data_type: int
      - name: NumLogins
        data_type: int
      - name: Amount
        data_type: decimal(10, 2)
  - name: products
    ext_full_refresh: true
    description: "External table with products information"
    external:
      location: "@my_dbt_database.bronze.my_s3_stage"  # reference an existing external stage
      file_format: "(TYPE = PARQUET)"
      # infer_schema: true   # parameter to tell Snowflake we want to infer the table schema
    columns:
      - name: ProductID
        data_type: int
      - name: ProductName
        data_type: varchar(100)
      - name: Category
        data_type: varchar(50)
      - name: Price
        data_type: decimal(10, 2)
  - name: subscriptions
    ext_full_refresh: true
    description: "External table with subscriptions information"
    external:
      location: "@my_dbt_database.bronze.my_s3_stage"  # reference an existing external stage
      file_format: "(TYPE = PARQUET)"
      # infer_schema: true   # parameter to tell Snowflake we want to infer the table schema
    columns:
      - name: SubscriptionID
        data_type: int
      - name: CustomerID
        data_type: int
      - name: StartDate
        data_type: date
      - name: EndDate
        data_type: date
      - name: Type
        data_type: varchar(50)
      - name: Status
        data_type: varchar(50)
  - name: support_interactions
    ext_full_refresh: true
    description: "External table with support interactions information"
    external:
      location: "@my_dbt_database.bronze.my_s3_stage"  # reference an existing external stage
      file_format: "(TYPE = PARQUET)"
      # infer_schema: true   # parameter to tell Snowflake we want to infer the table schema
    columns:
      - name: InteractionID
        data_type: int
      - name: CustomerID
        data_type: int
      - name: DateID
        data_type: int
      - name: IssueType
        data_type: varchar(100)
      - name: ResolutionTime
        data_type: int